---
- name: Set wsrep_sst_method to rsync for upgrade
  become: true
  shell: >
    {{ kolla_container_engine }} exec {{ mariadb_service.container_name }}
    mysql -uroot -p{{ database_password }}
    -e \"SET GLOBAL wsrep_sst_method='rsync';\"
  no_log: true

- import_tasks: deploy.yml
  vars:
    mariadb_wsrep_sst_method: "rsync"

- name: Set wsrep_sst_method to mariabackup after upgrade
  become: true
  shell: >
    {{ kolla_container_engine }} exec {{ mariadb_service.container_name }}
    mysql -uroot -p{{ database_password }}
    -e \"SET GLOBAL wsrep_sst_method='mariabackup';\"
  no_log: true

- import_tasks: deploy.yml

# TODO(seunghun1ee): Remove this task after 2026.1
- name: "Stop and remove mariadb_clustercheck containers"
  become: true
  kolla_container:
    action: "stop_and_remove_container"
    common_options: "{{ docker_common_options }}"
    name: "mariadb_clustercheck"
    ignore_missing: true
  when:
    - "'mariadb_clustercheck' not in skip_stop_containers"
